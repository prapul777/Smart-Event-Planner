<div class="event-list-container">
  <div class="header-section">
    <h1>Upcoming Events</h1>
    <button mat-raised-button color="primary" (click)="toggleFilters()" class="toggle-btn">
      <mat-icon>{{ showFilters ? 'expand_less' : 'expand_more' }}</mat-icon>
      {{ showFilters ? 'Hide Filters' : 'Show Filters' }}
    </button>
  </div>

  <!-- Filter Panel -->
  <mat-expansion-panel *ngIf="showFilters" class="filter-panel">
    <mat-expansion-panel-header>
      <mat-panel-title>
        <mat-icon>filter_list</mat-icon>
        Filter Events
      </mat-panel-title>
    </mat-expansion-panel-header>

    <div class="filter-content">
      <div class="filter-row">
        <!-- Category Filter -->
        <mat-form-field appearance="outline">
          <mat-label>Category</mat-label>
          <mat-select [(ngModel)]="selectedCategory" (selectionChange)="onFilterChange()">
            <mat-option value="">All Categories</mat-option>
            <mat-option *ngFor="let category of categories" [value]="category">
              {{ category }}
            </mat-option>
          </mat-select>
        </mat-form-field>

        <!-- Venue Filter -->
        <mat-form-field appearance="outline">
          <mat-label>Venue</mat-label>
          <input matInput [(ngModel)]="selectedVenue" (keyup)="onFilterChange()" placeholder="Search by venue">
        </mat-form-field>
      </div>

      <div class="filter-row">
        <!-- Start Date Filter -->
        <mat-form-field appearance="outline">
          <mat-label>From Date</mat-label>
          <input matInput type="date" [(ngModel)]="startDate" (change)="onFilterChange()">
        </mat-form-field>

        <!-- End Date Filter -->
        <mat-form-field appearance="outline">
          <mat-label>To Date</mat-label>
          <input matInput type="date" [(ngModel)]="endDate" (change)="onFilterChange()">
        </mat-form-field>
      </div>

      <div class="filter-actions">
        <button mat-raised-button color="warn" (click)="clearFilters()">
          <mat-icon>clear</mat-icon>
          Clear Filters
        </button>
      </div>
    </div>
  </mat-expansion-panel>

  <!-- Loading State -->
  <div *ngIf="loading" class="loading">
    <p>Loading events...</p>
  </div>

  <!-- Events Grid -->
  <div *ngIf="!loading" class="events-grid">
    <mat-card *ngFor="let event of filteredEvents" class="event-card">
      <mat-card-header>
        <mat-card-title>{{ event.name }}</mat-card-title>
        <mat-card-subtitle>{{ event.category }}</mat-card-subtitle>
      </mat-card-header>
      
      <mat-card-content>
        <p *ngIf="event.image_path"><img [src]="getImageUrl(event.image_path)" alt="event image" style="max-width:100%;height:auto;margin-bottom:8px"/></p>
        <p><strong>Venue:</strong> {{ event.venue }}</p>
        <p><strong>Date & Time:</strong> {{ event.date_time | date:'medium' }}</p>
        <p><strong>Available Seats:</strong> {{ event.available_seats || event.capacity }}</p>
        <p *ngIf="event.description">{{ event.description }}</p>
      </mat-card-content>

      <mat-card-actions>
        <button mat-button color="primary" (click)="viewEventDetails(event.id)">
          View Details
        </button>
        <button 
          mat-raised-button 
          color="accent" 
          (click)="bookTickets(event.id)"
          [disabled]="(event.available_seats || event.capacity) <= 0">
          Book Tickets
        </button>
      </mat-card-actions>
    </mat-card>
  </div>

  <!-- No Events Message -->
  <div *ngIf="!loading && filteredEvents.length === 0" class="no-events">
    <p>No events found matching your filters.</p>
  </div>
</div>

