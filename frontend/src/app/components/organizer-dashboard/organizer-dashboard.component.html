<div class="dashboard-container">
  <h1>Organizer Dashboard</h1>

  <!-- Create/Edit Event Form -->
  <mat-card class="form-card">
    <mat-card-header>
      <mat-card-title>{{ isEditing ? 'Edit Event' : 'Create New Event' }}</mat-card-title>
    </mat-card-header>
    <mat-card-content>
      <form [formGroup]="eventForm" (ngSubmit)="onSubmitEvent()">
        <div class="form-row">
          <mat-form-field appearance="outline">
            <mat-label>Event Name</mat-label>
            <input matInput formControlName="name" required>
          </mat-form-field>

          <mat-form-field appearance="outline">
            <mat-label>Category</mat-label>
            <mat-select formControlName="category" required>
              <mat-option value="Wedding">Wedding</mat-option>
              <mat-option value="Birthday">Birthday</mat-option>
              <mat-option value="Corporate">Corporate</mat-option>
              <mat-option value="Conference">Conference</mat-option>
              <mat-option value="Party">Party</mat-option>
              <mat-option value="Other">Other</mat-option>
            </mat-select>
          </mat-form-field>
        </div>

        <mat-form-field appearance="outline" style="width: 100%;">
          <mat-label>Description</mat-label>
          <textarea matInput formControlName="description" rows="3"></textarea>
        </mat-form-field>

        <div class="form-row">
          <mat-form-field appearance="outline">
            <mat-label>Venue</mat-label>
            <input matInput formControlName="venue" required>
          </mat-form-field>

          <mat-form-field appearance="outline">
            <mat-label>Date & Time</mat-label>
            <input matInput type="datetime-local" formControlName="date_time" required placeholder="Select date and time">
            <mat-hint>Click to open date/time picker</mat-hint>
          </mat-form-field>

          <mat-form-field appearance="outline">
            <mat-label>Capacity</mat-label>
            <input matInput type="number" formControlName="capacity" min="1" required>
          </mat-form-field>
        </div>

        <div class="form-actions">
          <button mat-raised-button color="primary" type="submit" [disabled]="!eventForm.valid">
            {{ isEditing ? 'Update Event' : 'Create Event' }}
          </button>
          <button *ngIf="isEditing" mat-button type="button" (click)="onCreateEvent()">
            Cancel
          </button>
        </div>
      </form>
    </mat-card-content>
  </mat-card>

  <!-- My Events List -->
  <mat-card class="events-card">
    <mat-card-header>
      <mat-card-title>My Events</mat-card-title>
    </mat-card-header>
    <mat-card-content>
      <div *ngIf="loading" class="loading">Loading events...</div>
      
      <table mat-table [dataSource]="events" *ngIf="!loading" class="events-table">
        <ng-container matColumnDef="name">
          <th mat-header-cell *matHeaderCellDef>Event Name</th>
          <td mat-cell *matCellDef="let event">{{ event.name }}</td>
        </ng-container>

        <ng-container matColumnDef="category">
          <th mat-header-cell *matHeaderCellDef>Category</th>
          <td mat-cell *matCellDef="let event">{{ event.category }}</td>
        </ng-container>

        <ng-container matColumnDef="date_time">
          <th mat-header-cell *matHeaderCellDef>Date & Time</th>
          <td mat-cell *matCellDef="let event">{{ event.date_time | date:'short' }}</td>
        </ng-container>

        <ng-container matColumnDef="tickets_sold">
          <th mat-header-cell *matHeaderCellDef>Tickets Sold</th>
          <td mat-cell *matCellDef="let event">{{ event.tickets_sold || 0 }} / {{ event.capacity }}</td>
        </ng-container>

        <ng-container matColumnDef="actions">
          <th mat-header-cell *matHeaderCellDef>Actions</th>
          <td mat-cell *matCellDef="let event">
            <button mat-button color="primary" (click)="onViewBookings(event)">
              View Sales
            </button>
            <button mat-button (click)="onEditEvent(event)">Edit</button>
            <button mat-button color="warn" (click)="onCancelEvent(event.id)">Cancel</button>
          </td>
        </ng-container>

        <tr mat-header-row *matHeaderRowDef="['name', 'category', 'date_time', 'tickets_sold', 'actions']"></tr>
        <tr mat-row *matRowDef="let row; columns: ['name', 'category', 'date_time', 'tickets_sold', 'actions']"></tr>
      </table>

      <div *ngIf="!loading && events.length === 0" class="no-events">
        <p>No events created yet.</p>
      </div>
    </mat-card-content>
  </mat-card>

  <!-- Bookings Section -->
  <mat-card *ngIf="selectedEvent" class="bookings-card">
    <mat-card-header>
      <mat-card-title>Bookings for: {{ selectedEvent.name }}</mat-card-title>
    </mat-card-header>
    <mat-card-content>
      <div *ngIf="bookingSummary" class="summary">
        <h3>Summary</h3>
        <p><strong>Total Bookings:</strong> {{ bookingSummary.total_bookings }}</p>
        <p><strong>Total Tickets Sold:</strong> {{ bookingSummary.total_tickets_sold }}</p>
        <p><strong>Total Revenue:</strong> ₹{{ bookingSummary.total_revenue }}</p>
      </div>

      <table mat-table [dataSource]="bookings" class="bookings-table">
        <ng-container matColumnDef="attendee_id">
          <th mat-header-cell *matHeaderCellDef>Attendee ID</th>
          <td mat-cell *matCellDef="let booking">{{ booking.attendee_id }}</td>
        </ng-container>

        <ng-container matColumnDef="tickets_booked">
          <th mat-header-cell *matHeaderCellDef>Tickets</th>
          <td mat-cell *matCellDef="let booking">{{ booking.tickets_booked }}</td>
        </ng-container>

        <ng-container matColumnDef="total_price">
          <th mat-header-cell *matHeaderCellDef>Amount</th>
          <td mat-cell *matCellDef="let booking">₹{{ booking.total_price }}</td>
        </ng-container>

        <ng-container matColumnDef="booking_time">
          <th mat-header-cell *matHeaderCellDef>Booking Time</th>
          <td mat-cell *matCellDef="let booking">{{ booking.booking_time | date:'short' }}</td>
        </ng-container>

        <tr mat-header-row *matHeaderRowDef="['attendee_id', 'tickets_booked', 'total_price', 'booking_time']"></tr>
        <tr mat-row *matRowDef="let row; columns: ['attendee_id', 'tickets_booked', 'total_price', 'booking_time']"></tr>
      </table>

      <div *ngIf="bookings.length === 0" class="no-bookings">
        <p>No bookings for this event yet.</p>
      </div>
    </mat-card-content>
  </mat-card>
</div>

